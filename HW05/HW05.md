# Họ và tên: Võ Văn Tùng
# MSSV: 22120409
# SSH Configuration

## 1. Disable SSH Access for the Root User

### Modify the SSH configuration to prevent root login
- Dùng lệnh:
```bash
    sudo vim /etc/ssh/sshd_config
    # Tìm và sửa dòng: PermitRootLogin no
```
- Giải thích: Mở file cấu hình SSH và thay đổi giá trị `PermitRootLogin` thành `no` để ngăn root đăng nhập qua SSH
- Kết quả:

### Restart the SSH service
- Dùng lệnh:
```bash
    sudo systemctl restart ssh
```
- Giải thích: Khởi động lại dịch vụ SSH để áp dụng các thay đổi cấu hình
- Kết quả:
### Verify service status and test root login
- Dùng lệnh:
```bash
    sudo systemctl status ssh
    ssh root@localhost
```
- Giải thích: Kiểm tra trạng thái dịch vụ SSH và thử đăng nhập root để xác nhận bị chặn.
- Kết quả:

## 2. Allow a User to Use SFTP but Deny SSH Shell Access

### Create a new user
- Dùng lệnh:
```bash
    sudo useradd -m -s /usr/sbin/nologin sftpuser
    sudo passwd sftpuser
```
- Giải thích: Tạo user `sftpuser` với shell `/usr/sbin/nologin` để ngăn truy cập shell interactive.

### Create chroot directory
- Dùng lệnh:
```bash
    sudo mkdir -p /sftp/sftpuser/upload
    sudo chown root:root /sftp/sftpuser
    sudo chmod 755 /sftp/sftpuser
    sudo chown sftpuser:sftpuser /sftp/sftpuser/upload
```
- Giải thích: Tạo cấu trúc thư mục cho chroot jail. Thư mục chroot phải thuộc sở hữu root, thư mục upload cho phép user ghi dữ liệu.

### Configure SSH for SFTP-only access
- Dùng lệnh:
```bash
    sudo vim /etc/ssh/sshd_config
```
- Giải thích: Thêm cấu hình sau vào cuối file:
```
    Match User sftpuser
        ForceCommand internal-sftp
        PasswordAuthentication yes
        ChrootDirectory /sftp/sftpuser
        PermitTunnel no
        AllowAgentForwarding no
        AllowTcpForwarding no
        X11Forwarding no
```
- Kết quả:

### Restart SSH service and test SFTP/SSH access
- Dùng lệnh
```bash
    sudo systemctl restart ssh
    sftp sftpuser@localhost
    ssh sftpuser@localhost
```
- Giải thích: Khởi động lại SSH, kiểm tra SFTP access (thành công) và SSH shell access (bị chặn).
- Kết quả:

## 3. Configure SSH Key-Based Authentication

### Create a new user
- Dùng lệnh:
```bash
    sudo useradd -m -s /bin/bash studentuser
    sudo passwd studentuser
```
- Giải thích: Tạo user `studentuser` với shell bash bình thường

### Generate SSH key pair
- Dùng lệnh:
```bash
    ssh-keygen -t rsa -b 4096
```
- Giải thích: Tạo cặp SSH key với thuật toán RSA 4096-bit
- Kết quả:

### Copy public key to server
- Dùng lệnh:
```bash
    ssh-copy-id studentuser@localhost
```
- Giải thích: Sao chép public key vào server để cho phép đăng nhập không cần mật khẩu
- Kết quả:

### Test key-based login
- Dùng lệnh:
```bash
    ssh studentuser@localhost
```
- Giải thích: Kiểm tra đăng nhập SSH bằng key, không cần nhập mật khẩu.
- Kết quả:

### Disable password-based SSH login
- Dùng lệnh:
```bash
    sudo vim /etc/ssh/sshd_config
    # Chỉnh các dòng thành như sau:
    # PasswordAuthentication no
    # PubkeyAuthentication yes
```
- Giải thích: Chỉnh sửa file cấu hình SSH để vô hiệu hóa đăng nhập bằng mật khẩu, chỉ cho phép đăng nhập bằng key.

### Restart SSH service and verify
- Dùng lệnh:
```bash
    sudo systemctl restart ssh
    sudo systemctl status ssh
```
- Giải thích: Khởi động lại SSH để áp dụng cấu hình và kiểm tra trạng thái dịch vụ.
- Kết quả: